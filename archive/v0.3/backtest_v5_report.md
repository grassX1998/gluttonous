# Backtest V5 回测报告

**日期**: 2026-01-14  
**策略**: 全市场选股（排除 CSI300 + CSI500 成分股）  
**标签定义**: `label = 1 if close[T+5] > close[T] else 0`  
**持有周期**: 5 个交易日

---

## 回测结果图表

### 综合图表（收益率 + 回撤 + 持仓）

![综合图表](images/backtest_v5_combined.png)

### 累计收益率曲线

![收益率曲线](images/backtest_v5_returns.png)

### 每日持仓数量

![持仓数量](images/backtest_v5_positions.png)

### 回撤曲线

![回撤曲线](images/backtest_v5_drawdown.png)

---

## 一、数据概况

| 项目 | 数值 |
|------|------|
| 股票数量 | 4,210 只 |
| 数据记录 | 1,534,565 条 |
| 特征数据 | 1,277,631 条 |
| 测试期间 | 2025-04-01 ~ 2026-01-13 |
| 交易日数 | 161~179 天 |
| 总预测数 | 752,698 条 |

---

## 二、模型配置

| 参数 | 值 |
|------|-----|
| 模型类型 | LSTM |
| 隐藏层大小 | 128 |
| LSTM 层数 | 2 |
| Dropout | 0.3 |
| Batch Size | 1024 |
| Epochs | 10 |
| Early Stop Patience | 3 |
| 训练窗口 | 6 个月 |
| 验证窗口 | 1 个月 |

### 特征列表（30个）

```
ret_1, ret_5, ret_10, ret_20,
ma_5_ratio, ma_10_ratio, ma_20_ratio, ma_60_ratio,
volatility_5, volatility_10, volatility_20,
rsi_14,
macd_dif, macd_dea, macd_hist,
bb_position,
volume_ratio_5, volume_ratio_10, volume_ratio_20,
turnover_ma_ratio,
open_gap,
price_vs_max_25,
price_breakout,
stop_loss_signal,
ma_10_vs_20,
price_vs_ma_10,
ret_2d,
price_vs_2d_max,
is_limit_up,
is_limit_down
```

---

## 三、回测结果对比

| 配置 | Top N | Prob | Sample | 收益率 | 年化收益 | Sharpe | 最大回撤 | 交易次数 | 胜率 |
|------|-------|------|--------|--------|----------|--------|----------|----------|------|
| **v0.2 基准** | 5 | 0.70 | - | +38.74% | - | **1.867** | **9.53%** | - | - |
| v5 Config 1 | 10 | 0.60 | 30% | **+89.88%** | +147.68% | 1.713 | 50.20% | 1,511 | 45.47% |
| v5 Config 2 | 5 | 0.70 | 30% | +1.24% | +1.91% | 0.373 | 44.01% | 737 | 44.10% |
| v5 Config 3 | 10 | 0.65 | 30% | -9.14% | -13.82% | 0.091 | 61.67% | 1,405 | 44.56% |
| **v5 Config 4** | 10 | 0.60 | **50%** | +74.84% | +118.21% | 1.566 | 47.04% | 1,682 | 47.03% |

---

## 四、验证准确率（Config 4）

| 测试月份 | 训练区间 | 验证月份 | 验证准确率 |
|----------|----------|----------|------------|
| 2025-04 | 2024-09~2025-02 | 2025-03 | 61.26% |
| 2025-05 | 2024-10~2025-03 | 2025-04 | 58.24% |
| 2025-06 | 2024-11~2025-04 | 2025-05 | **65.30%** |
| 2025-07 | 2024-12~2025-05 | 2025-06 | 61.77% |
| 2025-08 | 2025-01~2025-06 | 2025-07 | **52.01%** ⚠️ |
| 2025-09 | 2025-02~2025-07 | 2025-08 | **54.30%** ⚠️ |
| 2025-10 | 2025-03~2025-08 | 2025-09 | 62.37% |
| 2025-11 | 2025-04~2025-09 | 2025-10 | 63.58% |
| 2025-12 | 2025-05~2025-10 | 2025-11 | **65.69%** |
| 2026-01 | 2025-06~2025-11 | 2025-12 | 61.28% |

> ⚠️ 2025-08 和 2025-09 验证准确率显著下降，可能是市场压力期

---

## 五、关键发现

### 5.1 收益与风险

1. **收益表现优异**：Config 1 (+89.88%) 和 Config 4 (+74.84%) 均大幅超越基准 (+38.74%)
2. **回撤问题严重**：全市场策略最大回撤 47%~62%，远超基准的 9.53%
3. **风险调整收益**：Sharpe Ratio 1.5~1.7，略低于基准的 1.867

### 5.2 参数敏感性

| 发现 | 说明 |
|------|------|
| 概率阈值影响大 | prob=0.60 效果最好，0.65~0.70 表现大幅下降 |
| 采样比例影响稳定性 | 50% 采样比 30% 更稳定，但结果略低 |
| 随机种子重要 | 30% 采样下不同运行结果差异大 |

### 5.3 模型局限性

- 2025-07~2025-09 期间验证准确率下降，策略可能在市场压力期失效
- 交易胜率仅 45%~47%，需要靠盈亏比取胜

---

## 六、改进建议

### 6.1 降低回撤

1. **添加止损机制**：单笔亏损超过 X% 时强制平仓
2. **市场择时**：验证准确率 < 55% 时减仓或空仓
3. **分散持仓**：增加 Top N 数量（如 20~30 只）

### 6.2 提高稳定性

1. **使用全量数据训练**：不采样，获得更稳定的模型
2. **集成模型**：多个模型投票决策
3. **增加训练窗口**：使用 9~12 个月训练数据

### 6.3 组合策略

| 策略 | 资金配比 | 预期效果 |
|------|----------|----------|
| v0.2（低回撤） | 60% | 稳定收益，低回撤 |
| v5（高收益） | 40% | 追求超额收益 |

---

## 七、结论

全市场选股策略（v5）在收益率上显著优于 CSI500+1000 基准策略（v0.2），但最大回撤过高（47%+ vs 9.5%），不适合直接实盘使用。

**推荐方案**：
- 短期：使用 v0.2 策略保守运行
- 中期：优化 v5 策略的风控机制后再逐步放量
- 长期：开发组合策略，平衡收益与风险

---

## 附录：结果文件

| 配置 | 文件路径 |
|------|----------|
| Config 1 | `.pipeline_data/backtest_results/backtest_v5_20260114_212100.json` |
| Config 2 | `.pipeline_data/backtest_results/backtest_v5_20260114_212749.json` |
| Config 3 | `.pipeline_data/backtest_results/backtest_v5_20260114_213450.json` |
| Config 4 | `.pipeline_data/backtest_results/backtest_v5_20260114_214719.json` |
