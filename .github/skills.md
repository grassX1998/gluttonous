# Gluttonous Skills Documentation

æœ¬æ–‡æ¡£å®šä¹‰äº†é¡¹ç›®ä¸­å››ä¸ªæ ¸å¿ƒè§’è‰²çš„èŒè´£ã€è¾“å…¥è¾“å‡ºè§„èŒƒå’Œäº¤å‰éªŒè¯æœºåˆ¶ã€‚

---

## ğŸ§¹ Skill 1: æ•°æ®æ¸…æ´— (Data Cleaning)

### èŒè´£
ä»NASåŸå§‹æ•°æ®ä¸­æå–ã€æ¸…æ´—å’Œé¢„å¤„ç†è‚¡ç¥¨è¡Œæƒ…æ•°æ®ï¼Œç”Ÿæˆæ ‡å‡†åŒ–çš„æ¸…æ´—æ•°æ®ã€‚

### è¾“å…¥
- **æ•°æ®æº**: `\\DXP8800PRO-A577\data\stock\gm`
- **äº¤æ˜“æ—¥å†**: `cfg/trading_days.toml`
- **è¯åˆ¸åˆ—è¡¨**: `meta/instruments.parquet`
- **åˆ†é’ŸKçº¿**: `mkline/{symbol}/{date}.parquet`

### è¾“å‡º
- **ä½ç½®**: `.pipeline_data/cleaned/{symbol}.parquet`
- **æ ¼å¼**: Parquet + ZSTDå‹ç¼©
- **å­—æ®µ**: symbol, date, time, open, high, low, close, volume, turnover

### å¤„ç†é€»è¾‘
1. è¿‡æ»¤éè‚¡ç¥¨è¯åˆ¸ï¼ˆä¿ç•™SHSE/SZSEè‚¡ç¥¨ï¼‰
2. ç§»é™¤ç©ºå€¼å’Œå¼‚å¸¸å€¼ï¼ˆæ¶¨è·Œå¹…>20%ã€æˆäº¤é‡<=0ï¼‰
3. éªŒè¯ä»·æ ¼é€»è¾‘ï¼ˆhigh >= low, closeåœ¨high/lowä¹‹é—´ï¼‰
4. æŒ‰æ—¥æœŸ+æ—¶é—´æ’åº
5. æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ï¼ˆæœ€å°‘60ä¸ªäº¤æ˜“æ—¥ï¼‰

### è¿è¡Œå‘½ä»¤
```powershell
python -m pipeline.data_cleaning.clean --start_date 2024-06-01 --end_date 2025-12-31
```

### éªŒè¯è¦ç‚¹ï¼ˆä¾›æ•°æ®æ ¡éªŒè§’è‰²æ£€æŸ¥ï¼‰
- [ ] è¾“å‡ºæ–‡ä»¶æ•°é‡ä¸æœ‰æ•ˆè‚¡ç¥¨æ•°é‡ä¸€è‡´
- [ ] æ¯ä¸ªæ–‡ä»¶åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
- [ ] æ— ç©ºå€¼å’Œå¼‚å¸¸å€¼
- [ ] ä»·æ ¼é€»è¾‘æ­£ç¡®
- [ ] æ•°æ®é‡æ»¡è¶³æœ€å°å¤©æ•°è¦æ±‚

---

## âœ… Skill 2: æ•°æ®æ ¡éªŒ (Data Validation)

### èŒè´£
éªŒè¯æ¸…æ´—åæ•°æ®å’Œç‰¹å¾æ•°æ®çš„è´¨é‡ï¼Œç¡®ä¿æ•°æ®å¯ç”¨äºæ¨¡å‹è®­ç»ƒã€‚

### è¾“å…¥
- **æ¸…æ´—æ•°æ®**: `.pipeline_data/cleaned/*.parquet`
- **ç‰¹å¾æ•°æ®**: `.pipeline_data/features/*.parquet`ï¼ˆå¦‚å­˜åœ¨ï¼‰
- **è®­ç»ƒæ•°æ®**: `.pipeline_data/train/*.npz`ï¼ˆå¦‚å­˜åœ¨ï¼‰

### è¾“å‡º
- **éªŒè¯æŠ¥å‘Š**: `.pipeline_data/validation_report.json`
- **æ—¥å¿—**: æ§åˆ¶å°è¾“å‡ºéªŒè¯ç»“æœ

### éªŒè¯é¡¹ç›®

#### å¯¹æ¸…æ´—æ•°æ®çš„æ ¡éªŒ
| æ£€æŸ¥é¡¹ | æ ‡å‡† | ä¸¥é‡ç¨‹åº¦ |
|--------|------|----------|
| ç¼ºå¤±å€¼æ£€æŸ¥ | æ— ç¼ºå¤±å€¼ | Error |
| æ•°æ®é‡æ£€æŸ¥ | æ¯åªè‚¡ç¥¨ >= 1000æ¡è®°å½• | Warning |
| ä»·æ ¼èŒƒå›´ | close > 0 | Error |
| æ•°æ®ç±»å‹ | ç¬¦åˆé¢„æœŸdtype | Error |

#### å¯¹ç‰¹å¾æ•°æ®çš„æ ¡éªŒ
| æ£€æŸ¥é¡¹ | æ ‡å‡† | ä¸¥é‡ç¨‹åº¦ |
|--------|------|----------|
| NaNæ£€æŸ¥ | ç‰¹å¾æ— NaN | Error |
| Infæ£€æŸ¥ | ç‰¹å¾æ— Inf | Error |
| åˆ†å¸ƒæ£€æŸ¥ | æ— æç«¯å¼‚å¸¸å€¼ | Warning |
| æ ‡ç­¾å¹³è¡¡ | æ­£è´Ÿæ ·æœ¬æ¯”ä¾‹åˆç†(0.3-0.7) | Warning |

### è¿è¡Œå‘½ä»¤
```powershell
python -m pipeline.data_validation.validate
```

### äº¤å‰éªŒè¯ï¼ˆéªŒè¯å…¶ä»–è§’è‰²çš„è¾“å‡ºï¼‰
- **éªŒè¯æ¸…æ´—ç»“æœ**: æ£€æŸ¥ `.pipeline_data/cleaned/` ç›®å½•
- **éªŒè¯ç‰¹å¾ç»“æœ**: æ£€æŸ¥ `.pipeline_data/features/` ç›®å½•
- **éªŒè¯è®­ç»ƒæ•°æ®**: æ£€æŸ¥ `.pipeline_data/train/` ç›®å½•çš„npzæ–‡ä»¶

---

## ğŸ“ Skill 3: æ¨¡å‹è®­ç»ƒ (Training)

### èŒè´£
ä½¿ç”¨GPUåŠ é€Ÿè®­ç»ƒLSTM/Transformeræ¨¡å‹ï¼Œé¢„æµ‹è‚¡ç¥¨æ¶¨è·Œã€‚

### è¾“å…¥
- **è®­ç»ƒæ•°æ®**: `.pipeline_data/train/train.npz`
- **éªŒè¯æ•°æ®**: `.pipeline_data/train/val.npz`
- **æµ‹è¯•æ•°æ®**: `.pipeline_data/train/test.npz`
- **æ ‡å‡†åŒ–å‚æ•°**: `.pipeline_data/checkpoints/X_mean.npy`, `X_std.npy`

### è¾“å‡º
- **æ¨¡å‹æ£€æŸ¥ç‚¹**: `.pipeline_data/checkpoints/best_model.pt`
- **è®­ç»ƒå†å²**: `.pipeline_data/checkpoints/training_history.json`
- **è®­ç»ƒæ—¥å¿—**: `.pipeline_data/checkpoints/training.log`

### æ¨¡å‹é…ç½®
```python
{
    "model_type": "lstm",
    "hidden_size": 128,
    "num_layers": 3,
    "dropout": 0.3,
    "batch_size": 512,  # GPUåŠ é€Ÿ
    "epochs": 100,
    "learning_rate": 0.001,
    "use_amp": True,  # æ··åˆç²¾åº¦è®­ç»ƒ
}
```

### GPUä¼˜åŒ–æŠ€æœ¯
1. **æ··åˆç²¾åº¦è®­ç»ƒ (AMP)**: ä½¿ç”¨float16å‡å°‘æ˜¾å­˜å ç”¨ï¼ŒåŠ é€Ÿè®¡ç®—
2. **æ¢¯åº¦è£å‰ª**: é˜²æ­¢æ¢¯åº¦çˆ†ç‚¸
3. **å¤šè¿›ç¨‹æ•°æ®åŠ è½½**: `num_workers=8`, `pin_memory=True`
4. **é¢„å–æœºåˆ¶**: `prefetch_factor=4`

### è¿è¡Œå‘½ä»¤
```powershell
# é»˜è®¤é…ç½®
python -m pipeline.training.train

# è‡ªå®šä¹‰é…ç½®
python -m pipeline.training.train --batch_size 1024 --epochs 200 --learning_rate 0.0005
```

### è¯„ä¼°æŒ‡æ ‡
| æŒ‡æ ‡ | è¯´æ˜ | ç›®æ ‡ |
|------|------|------|
| Accuracy | åˆ†ç±»å‡†ç¡®ç‡ | > 55% |
| Precision | æ­£ç±»ç²¾ç¡®ç‡ | > 50% |
| Recall | æ­£ç±»å¬å›ç‡ | > 50% |
| F1 Score | F1åˆ†æ•° | > 50% |

### éªŒè¯è¦ç‚¹ï¼ˆä¾›æ•°æ®æ ¡éªŒè§’è‰²æ£€æŸ¥ï¼‰
- [ ] è®­ç»ƒæŸå¤±æŒç»­ä¸‹é™
- [ ] éªŒè¯æŸå¤±æ— ä¸¥é‡è¿‡æ‹Ÿåˆ
- [ ] æµ‹è¯•é›†æŒ‡æ ‡ä¸éªŒè¯é›†æ¥è¿‘
- [ ] æ¨¡å‹æ–‡ä»¶æ­£å¸¸ä¿å­˜

---

## ğŸ“Š Skill 4: ç­–ç•¥å›æµ‹ (Backtest)

### èŒè´£
ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œå†å²å›æµ‹ï¼Œè¯„ä¼°ç­–ç•¥è¡¨ç°ã€‚

### è¾“å…¥
- **æ¨¡å‹**: `.pipeline_data/checkpoints/best_model.pt`
- **æ ‡å‡†åŒ–å‚æ•°**: `.pipeline_data/checkpoints/X_mean.npy`, `X_std.npy`
- **æ¸…æ´—æ•°æ®**: `.pipeline_data/cleaned/*.parquet`

### è¾“å‡º
- **å›æµ‹æŠ¥å‘Š**: `.pipeline_data/backtest_results/report_{timestamp}.json`
- **äº¤æ˜“è®°å½•**: `.pipeline_data/backtest_results/trades_{timestamp}.csv`
- **æ¯æ—¥å‡€å€¼**: `.pipeline_data/backtest_results/daily_values_{timestamp}.csv`

### å›æµ‹é…ç½®
```python
{
    "initial_cash": 1_000_000,  # åˆå§‹èµ„é‡‘100ä¸‡
    "max_positions": 10,       # æœ€å¤§æŒä»“10åª
    "commission_rate": 0.0003, # æ‰‹ç»­è´¹ä¸‡ä¸‰
    "slippage": 0.001,         # æ»‘ç‚¹åƒä¸€
    "min_probability": 0.6,    # æœ€å°ä¹°å…¥æ¦‚ç‡
    "stop_loss": -0.08,        # æ­¢æŸ8%
    "take_profit": 0.15,       # æ­¢ç›ˆ15%
    "max_holding_days": 20,    # æœ€å¤§æŒä»“20å¤©
}
```

### ç­–ç•¥é€»è¾‘
1. **é€‰è‚¡**: æ¨¡å‹é¢„æµ‹ä¸Šæ¶¨æ¦‚ç‡ > `min_probability` çš„è‚¡ç¥¨
2. **ä¹°å…¥**: ç­‰æƒåˆ†é…èµ„é‡‘ï¼Œæ¯æ¬¡ä¹°å…¥æ•´ç™¾è‚¡
3. **å–å‡ºæ¡ä»¶**:
   - è§¦å‘æ­¢æŸ (`profit < stop_loss`)
   - è§¦å‘æ­¢ç›ˆ (`profit > take_profit`)
   - è¾¾åˆ°æœ€å¤§æŒä»“å¤©æ•°
   - æ¨¡å‹ä¿¡å·åè½¬

### è¿è¡Œå‘½ä»¤
```powershell
python -m pipeline.backtest.backtest --start_date 2025-01-01 --end_date 2025-12-31
```

### å›æµ‹æŒ‡æ ‡
| æŒ‡æ ‡ | è¯´æ˜ | åŸºå‡† |
|------|------|------|
| Total Return | æ€»æ”¶ç›Šç‡ | > æ²ªæ·±300 |
| Annual Return | å¹´åŒ–æ”¶ç›Šç‡ | > 10% |
| Max Drawdown | æœ€å¤§å›æ’¤ | < 20% |
| Sharpe Ratio | å¤æ™®æ¯”ç‡ | > 1.0 |
| Win Rate | èƒœç‡ | > 50% |

### éªŒè¯è¦ç‚¹ï¼ˆä¾›æ•°æ®æ ¡éªŒè§’è‰²æ£€æŸ¥ï¼‰
- [ ] åˆå§‹èµ„é‡‘æ­£ç¡®
- [ ] äº¤æ˜“è®°å½•å®Œæ•´
- [ ] æ‰‹ç»­è´¹è®¡ç®—æ­£ç¡®
- [ ] æ­¢æŸæ­¢ç›ˆé€»è¾‘æ­£ç¡®
- [ ] æŒ‡æ ‡è®¡ç®—æ­£ç¡®

---

## ğŸ”„ äº¤å‰éªŒè¯æœºåˆ¶

### æµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®æ¸…æ´—    â”‚â”€â”€â”€â”€â–¶â”‚  æ•°æ®æ ¡éªŒ    â”‚â”€â”€â”€â”€â–¶â”‚  æ¨¡å‹è®­ç»ƒ    â”‚â”€â”€â”€â”€â–¶â”‚  ç­–ç•¥å›æµ‹    â”‚
â”‚  (Cleaning)  â”‚     â”‚  (Validate)  â”‚     â”‚  (Training)  â”‚     â”‚  (Backtest)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚                    â”‚                    â”‚
       â”‚                    â–¼                    â”‚                    â”‚
       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  äº¤å‰éªŒè¯   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚   æŠ¥å‘Š      â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éªŒè¯çŸ©é˜µ

| è¢«éªŒè¯è€… \ éªŒè¯è€… | æ¸…æ´— | æ ¡éªŒ | è®­ç»ƒ | å›æµ‹ |
|-------------------|------|------|------|------|
| **æ¸…æ´—è¾“å‡º**      | -    | âœ“    | âœ“    | âœ“    |
| **æ ¡éªŒæŠ¥å‘Š**      | -    | -    | âœ“    | âœ“    |
| **è®­ç»ƒæ¨¡å‹**      | -    | âœ“    | -    | âœ“    |
| **å›æµ‹ç»“æœ**      | -    | âœ“    | âœ“    | -    |

### éªŒè¯æ£€æŸ¥æ¸…å•

#### æ¸…æ´— â†’ æ ¡éªŒ
```powershell
# è¿è¡Œæ•°æ®æ ¡éªŒ
python -m pipeline.data_validation.validate
# æ£€æŸ¥ validation_report.json ä¸­çš„ symbols_passed ä¸ cleaned æ–‡ä»¶æ•°é‡ä¸€è‡´
```

#### æ ¡éªŒ â†’ è®­ç»ƒ
```powershell
# ç¡®ä¿æ—  Error çº§åˆ«é—®é¢˜
# æ£€æŸ¥æ ‡ç­¾åˆ†å¸ƒæ˜¯å¦åˆç†
```

#### è®­ç»ƒ â†’ å›æµ‹
```powershell
# ç¡®ä¿ best_model.pt å­˜åœ¨
# ç¡®ä¿ X_mean.npy å’Œ X_std.npy å­˜åœ¨
# æ£€æŸ¥æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„è¡¨ç°
```

#### å›æµ‹ â†’ éªŒè¯
```powershell
# æ£€æŸ¥å›æµ‹æŒ‡æ ‡æ˜¯å¦åˆç†
# æ£€æŸ¥äº¤æ˜“è®°å½•æ˜¯å¦å®Œæ•´
# éªŒè¯æ”¶ç›Šè®¡ç®—æ˜¯å¦æ­£ç¡®
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®Œæ•´æµç¨‹
```powershell
# 1. æ•°æ®æ¸…æ´—
python -m pipeline.data_cleaning.clean --start_date 2024-06-01 --end_date 2025-12-31

# 2. æ•°æ®æ ¡éªŒ
python -m pipeline.data_validation.validate

# 3. ç‰¹å¾å·¥ç¨‹
python -m pipeline.data_cleaning.features

# 4. å†æ¬¡æ ¡éªŒ
python -m pipeline.data_validation.validate

# 5. æ¨¡å‹è®­ç»ƒ
python -m pipeline.training.train --batch_size 512 --epochs 100

# 6. ç­–ç•¥å›æµ‹
python -m pipeline.backtest.backtest --start_date 2025-01-01 --end_date 2025-12-31
```

### æµ‹è¯•æµç¨‹ï¼ˆå°‘é‡æ•°æ®ï¼‰
```powershell
# ä½¿ç”¨é™åˆ¶æ•°é‡è¿›è¡Œå¿«é€Ÿæµ‹è¯•
python -m pipeline.data_cleaning.clean --start_date 2024-06-01 --end_date 2024-12-31 --limit 50
python -m pipeline.data_cleaning.features --limit 50
python -m pipeline.training.train --batch_size 128 --epochs 10
python -m pipeline.backtest.backtest --start_date 2025-01-01 --end_date 2025-03-31
```

---

## ğŸ“ æ•°æ®æµå›¾

```
NASåŸå§‹æ•°æ®                    æœ¬åœ°SSD (.pipeline_data/)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
\\DXP8800PRO-A577\
data\stock\gm\
    â”‚
    â”œâ”€â”€ cfg/trading_days.toml
    â”œâ”€â”€ meta/instruments.parquet
    â””â”€â”€ mkline/{symbol}/{date}.parquet
            â”‚
            â”‚  [æ•°æ®æ¸…æ´—]
            â–¼
                                cleaned/{symbol}.parquet
                                        â”‚
                                        â”‚  [ç‰¹å¾å·¥ç¨‹]
                                        â–¼
                                features/{symbol}.parquet
                                        â”‚
                                        â”‚  [æ•°æ®å‡†å¤‡]
                                        â–¼
                                train/
                                â”œâ”€â”€ train.npz
                                â”œâ”€â”€ val.npz
                                â””â”€â”€ test.npz
                                        â”‚
                                        â”‚  [æ¨¡å‹è®­ç»ƒ]
                                        â–¼
                                checkpoints/
                                â”œâ”€â”€ best_model.pt
                                â”œâ”€â”€ X_mean.npy
                                â””â”€â”€ X_std.npy
                                        â”‚
                                        â”‚  [ç­–ç•¥å›æµ‹]
                                        â–¼
                                backtest_results/
                                â”œâ”€â”€ report_{ts}.json
                                â”œâ”€â”€ trades_{ts}.csv
                                â””â”€â”€ daily_values_{ts}.csv
```
