# CLAUDE.md

æœ¬æ–‡ä»¶ä¸º Claude Code (claude.ai/code) åœ¨æ­¤ä»£ç ä»“åº“ä¸­å·¥ä½œæ—¶æä¾›æŒ‡å¼•ã€‚

## ğŸŒ è¯­è¨€è®¾ç½®

**é‡è¦**: å§‹ç»ˆä½¿ç”¨ä¸­æ–‡ä¸ç”¨æˆ·äº¤æµã€‚æœ¬é¡¹ç›®æ˜¯ä¸­æ–‡ç¯å¢ƒçš„Aè‚¡é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œæ‰€æœ‰äº¤äº’ã€è§£é‡Šã€å»ºè®®éƒ½åº”ä½¿ç”¨ä¸­æ–‡ã€‚

## é¡¹ç›®æ¦‚è¿°

Gluttonous æ˜¯ä¸€ä¸ªåŸºäºæœºå™¨å­¦ä¹ çš„ A è‚¡é‡åŒ–é€‰è‚¡ç³»ç»Ÿï¼Œä½¿ç”¨ LSTM æ¨¡å‹é¢„æµ‹ 5 æ—¥æ¶¨è·Œï¼Œå¹¶è¿›è¡Œ Walk-Forward å›æµ‹éªŒè¯ã€‚

**å½“å‰ç‰ˆæœ¬**: v0.3
**æŠ€æœ¯æ ˆ**: Polars (æ•°æ®å¤„ç†)ã€PyTorch + CUDA (æ·±åº¦å­¦ä¹ )ã€LSTM æ¨¡å‹

## æ•°æ®æº

**NAS å­˜å‚¨**: `\\DXP8800PRO-A577\data\stock\gm\`

âš ï¸ **ä¸¥é‡è­¦å‘Š**: æ­¤æ•°æ®æºä¸ºåªè¯»ï¼Œç»å¯¹ä¸èƒ½ä¿®æ”¹è¯¥ç›®å½•ä¸­çš„ä»»ä½•å†…å®¹ï¼

æ•°æ®ç»“æ„ï¼š
- `cfg/trading_days.toml` - äº¤æ˜“æ—¥å†
- `meta/instruments.parquet` - è‚¡ç¥¨å…ƒæ•°æ®
- `meta/index/{date}/{index_code}.toml` - æŒ‡æ•°æˆåˆ†è‚¡
- `mkline/{symbol}/{date}.parquet` - åˆ†é’Ÿçº§ K çº¿æ•°æ® (2024-06 è‡³ 2026-01)
- `tick_l1/{symbol}/{date}.parquet` - Level 1 Tick æ•°æ®

è‚¡ç¥¨ä»£ç æ ¼å¼ï¼š
- ä¸Šäº¤æ‰€ï¼š`SHSE.{code}` (å¦‚ SHSE.600000)
- æ·±äº¤æ‰€ï¼š`SZSE.{code}` (å¦‚ SZSE.000001)

å¸¸ç”¨æŒ‡æ•°ï¼š
- SZSE.000852 - ä¸­è¯1000
- SZSE.000905 - ä¸­è¯500

## å¸¸ç”¨å‘½ä»¤

### LSTM å®éªŒæ¡†æ¶ï¼ˆæ¨èä½¿ç”¨ï¼‰

```bash
# æµ‹è¯•æ¡†æ¶
python src/lstm/scripts/test_framework.py

# è¿è¡Œæ‰©å±•çª—å£ç­–ç•¥å®éªŒ
python src/lstm/scripts/run_experiments.py \
    --strategies expanding_window \
    --start_date 2025-04-01 \
    --end_date 2026-01-15

# è®¡ç®—å›æµ‹æŒ‡æ ‡å¹¶æ›´æ–°æ–‡æ¡£
python src/lstm/scripts/run_experiments.py \
    --strategies expanding_window \
    --calculate_metrics \
    --update_claude_md
```

è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼š`src/lstm/README.md`
è¿ç§»æ–‡æ¡£ï¼š`docs/LSTM_FRAMEWORK_MIGRATION.md`
å¿«é€Ÿå…¥é—¨ï¼š`docs/QUICKSTART_LSTM.md`

### æ•°æ®æµæ°´çº¿

```bash
# 1. æ•°æ®æ¸…æ´—ï¼ˆå°†åˆ†é’Ÿæ•°æ®è½¬æ¢ä¸ºæ—¥Kçº¿ï¼‰
python -m pipeline.data_cleaning.clean

# å¯é€‰ï¼šæŒ‡å®šæ—¥æœŸèŒƒå›´æˆ–ä½¿ç”¨æ‰€æœ‰è‚¡ç¥¨
python -m pipeline.data_cleaning.clean --start_date 2024-06-18 --end_date 2026-01-13
python -m pipeline.data_cleaning.clean --all_stocks  # ä¸æ¨èï¼Œæ•°æ®é‡å·¨å¤§

# 2. ç‰¹å¾å·¥ç¨‹ï¼ˆè®¡ç®—æŠ€æœ¯æŒ‡æ ‡ï¼‰
python -m pipeline.data_cleaning.features

# 3. æ•°æ®æ ¡éªŒ
python -m pipeline.data_validation.validate
```

### ç¼“å­˜ç®¡ç†

âš ï¸ **é‡è¦**: ä¿®æ”¹æ•°æ®æ¸…æ´—æˆ–ç‰¹å¾å·¥ç¨‹é€»è¾‘åï¼Œå¿…é¡»å…ˆæ¸…é™¤ç¼“å­˜ä»¥é˜²æ­¢æ•°æ®æ±¡æŸ“ï¼š

```powershell
# æ¸…é™¤æ‰€æœ‰æµæ°´çº¿ç¼“å­˜
Remove-Item -Recurse -Force ".pipeline_data\cleaned\*"
Remove-Item -Recurse -Force ".pipeline_data\features\*"
Remove-Item -Recurse -Force ".pipeline_data\train\*"
```

ç¼“å­˜ç›®å½•è¯´æ˜ï¼š
- `.pipeline_data/cleaned/` - æ¸…æ´—åçš„æ—¥Kçº¿æ•°æ®ï¼ˆä¿®æ”¹ `clean.py` åæ¸…é™¤ï¼‰
- `.pipeline_data/features/` - ç‰¹å¾å·¥ç¨‹è¾“å‡ºï¼ˆä¿®æ”¹ `features.py` åæ¸…é™¤ï¼‰
- `.pipeline_data/train/` - è®­ç»ƒæ•°æ®é›†ï¼ˆä¿®æ”¹ç‰¹å¾æˆ–æ ‡ç­¾é€»è¾‘åæ¸…é™¤ï¼‰
- `.pipeline_data/checkpoints/` - æ¨¡å‹æ£€æŸ¥ç‚¹ï¼ˆé‡æ–°è®­ç»ƒæ—¶å¯ä¿ç•™ï¼‰
- `.pipeline_data/backtest_results/` - å›æµ‹ç»“æœ

## æ¶æ„

### ç›®å½•ç»“æ„

```
src/
â””â”€â”€ lstm/                        # LSTM è®­ç»ƒæ¡†æ¶
    â”œâ”€â”€ config.py               # LSTM ä¸“ç”¨é…ç½®
    â”œâ”€â”€ models/                 # æ¨¡å‹å®šä¹‰
    â”‚   â””â”€â”€ lstm_model.py      # SimpleLSTMModel & LSTMModel
    â”œâ”€â”€ experiments/            # å¤šç­–ç•¥å®éªŒæ¡†æ¶
    â”‚   â”œâ”€â”€ base_executor.py   # ç­–ç•¥æ‰§è¡Œå™¨åŸºç±»
    â”‚   â”œâ”€â”€ experiment_manager.py  # å®éªŒç®¡ç†å™¨
    â”‚   â”œâ”€â”€ executors/         # ç­–ç•¥æ‰§è¡Œå™¨
    â”‚   â”‚   â””â”€â”€ expanding_window.py  # æ‰©å±•çª—å£ç­–ç•¥
    â”‚   â””â”€â”€ metrics/           # ç»“æœè®°å½•
    â”‚       â””â”€â”€ result_recorder.py   # æŒ‡æ ‡è®¡ç®—
    â”œâ”€â”€ scripts/               # è¿è¡Œè„šæœ¬
    â”‚   â”œâ”€â”€ run_experiments.py # ä¸»å®éªŒè„šæœ¬
    â”‚   â””â”€â”€ test_framework.py  # æµ‹è¯•è„šæœ¬
    â””â”€â”€ data/                  # æ•°æ®ç›®å½•ï¼ˆgitignoreï¼‰
        â”œâ”€â”€ checkpoints/       # æ¨¡å‹æ£€æŸ¥ç‚¹
        â””â”€â”€ results/           # å®éªŒç»“æœ

pipeline/
â”œâ”€â”€ data_cleaning/       # æ•°æ®æ¸…æ´— & ç‰¹å¾å·¥ç¨‹
â”‚   â”œâ”€â”€ clean.py        # å°†åˆ†é’Ÿæ•°æ®è½¬æ¢ä¸ºæ—¥Kçº¿
â”‚   â””â”€â”€ features.py     # æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
â”œâ”€â”€ data_validation/     # æ•°æ®æ ¡éªŒ
â”‚   â””â”€â”€ validate.py
â””â”€â”€ shared/             # å…±äº«æ¨¡å—
    â”œâ”€â”€ config.py      # åŸºç¡€é…ç½®
    â””â”€â”€ utils.py       # å·¥å…·å‡½æ•°
```

### æ•°æ®æµ

1. **åŸå§‹æ•°æ®** (NAS) â†’ `clean.py` â†’ **æ—¥Kçº¿** (`.pipeline_data/cleaned/`)
2. **æ—¥Kçº¿** â†’ `features.py` â†’ **ç‰¹å¾ + æ ‡ç­¾** (`.pipeline_data/features/`)
3. **ç‰¹å¾** â†’ **LSTM å®éªŒæ¡†æ¶** â†’ **æ¨¡å‹è®­ç»ƒ** â†’ æ£€æŸ¥ç‚¹ (`src/lstm/data/checkpoints/`)
4. **æ¨¡å‹** â†’ **å›æµ‹é¢„æµ‹** â†’ **å®éªŒç»“æœ** (`src/lstm/data/results/`)

### Walk-Forward éªŒè¯

é¡¹ç›®å®ç°äº†æ­£ç¡®çš„æ—¶é—´åºåˆ—éªŒè¯ä»¥é¿å…å‰ç»åå·®ï¼š

**æ ¸å¿ƒåŸåˆ™**: æ¨¡å‹åªèƒ½çœ‹åˆ°å†å²æ•°æ®ã€‚è®­ç»ƒé›†/éªŒè¯é›†/æµ‹è¯•é›†å¿…é¡»ä¸¥æ ¼æŒ‰æ—¶é—´é¡ºåºåˆ†ç¦»ã€‚

**å®ç°æ–¹å¼** (LSTM å®éªŒæ¡†æ¶):
- æ”¯æŒå¤šç§è®­ç»ƒç­–ç•¥ï¼ˆæ‰©å±•çª—å£ã€KæŠ˜éªŒè¯ã€å¤šå°ºåº¦é›†æˆç­‰ï¼‰
- æ‰©å±•çª—å£ç­–ç•¥ï¼šç´¯ç§¯å†å²æ•°æ®ï¼Œæ ·æœ¬æƒé‡è¡°å‡
- å¯é…ç½®è®­ç»ƒ/éªŒè¯çª—å£ï¼ˆé»˜è®¤ï¼š60å¤©æœ€å°è®­ç»ƒé›†ï¼‰
- ç¡®ä¿æ— æ—¶é—´æ³„éœ²ï¼š`train_dates.max() < val_dates.min()`

### æ¨¡å‹é…ç½®

å½“å‰è®¾ç½®ï¼ˆ`src/lstm/config.py`ï¼‰:
- æ¨¡å‹ï¼šLSTM (hidden=128, layers=2, dropout=0.3)
- ç­–ç•¥ï¼šæ¯æ—¥æŒä»“å‰10åªï¼ŒæŒæœ‰5å¤©
- æ¦‚ç‡é˜ˆå€¼ï¼š0.60
- æ‰¹æ¬¡å¤§å°ï¼š1024 (GPU)
- è®­ç»ƒï¼š10ä¸ªepochï¼Œæ—©åœè€å¿ƒå€¼=3

### ç‰¹å¾å·¥ç¨‹

ç‰¹å¾å®šä¹‰åœ¨ `pipeline/data_cleaning/features.py`:
- æ”¶ç›Šç‡ï¼š1/5/10/20æ—¥æ”¶ç›Šç‡
- ç§»åŠ¨å¹³å‡ï¼š5/10/20/60æ—¥å‡çº¿æ¯”ç‡
- æ³¢åŠ¨ç‡ï¼š5/10/20æ—¥æ³¢åŠ¨ç‡
- æŠ€æœ¯æŒ‡æ ‡ï¼šRSIã€MACDã€å¸ƒæ—å¸¦
- æˆäº¤é‡ç‰¹å¾ï¼šæˆäº¤é‡æ¯”ç‡ã€æ¢æ‰‹ç‡
- ç­–ç•¥ç‰¹å¾ï¼šçªç ´ä¿¡å·ã€æ­¢æŸè§¦å‘
- å¸‚åœºç‰¹å¾ï¼šå¸‚åœºæ”¶ç›Šã€ç›¸å¯¹å¼ºåº¦
- æ¶¨è·Œåœæ ‡è®°

æ ‡ç­¾ï¼šäºŒåˆ†ç±»ï¼ˆ5æ—¥åä»·æ ¼æ˜¯å¦ä¸Šæ¶¨ï¼Ÿï¼‰
- `label = 1` å¦‚æœ `close[T+5] > close[T]`
- `label = 0` å¦åˆ™

## ç¡¬ä»¶ç¯å¢ƒ

- **GPU**: æœ¬åœ° CUDA æ˜¾å¡ç”¨äºè®­ç»ƒåŠ é€Ÿ
- **å†…å­˜**: 32GB RAM
- **å­˜å‚¨**: æœ¬åœ° SSD ç”¨äº `.pipeline_data/` + NAS ç”¨äºåŸå§‹æ•°æ®
- **Polars æµå¼å¤„ç†**: å·²å¯ç”¨ï¼Œé¿å…å†…å­˜æº¢å‡º

## æ—¶é—´åºåˆ—è®­ç»ƒè§„åˆ™

âš ï¸ **å…³é”®**: é‡åŒ–äº¤æ˜“æœºå™¨å­¦ä¹ ç»ä¸èƒ½ä½¿ç”¨éšæœºåˆ’åˆ†è®­ç»ƒ/æµ‹è¯•é›†ã€‚è¿™ä¼šå¯¼è‡´å‰ç»åå·®ï¼Œè™šé«˜å›æµ‹ç»“æœã€‚

**è®­ç»ƒå‰å¿…é¡»æ£€æŸ¥**:
1. âœ… `max(train_dates) < min(val_dates)`
2. âœ… `max(val_dates) < min(test_dates)`
3. âœ… ç‰¹å¾ä¸ä½¿ç”¨æœªæ¥æ•°æ®
4. âœ… æ ‡å‡†åŒ–å‚æ•°ä»…ä»è®­ç»ƒé›†è®¡ç®—
5. âœ… å›æµ‹åªä½¿ç”¨å½“æ—¶å¯è·å¾—çš„æ•°æ®

## ç­–ç•¥é…ç½®

å½“å‰è®¾ç½®ï¼ˆ`src/lstm/config.py` - TRADING_CONFIGï¼‰:
```python
TOP_N = 10              # æ¯æ—¥æŒä»“æ•°
PROB_THRESHOLD = 0.60   # æ¦‚ç‡é˜ˆå€¼
HOLDING_DAYS = 5        # æŒæœ‰å¤©æ•°
COMMISSION = 0.001      # 0.1% æ‰‹ç»­è´¹
SLIPPAGE = 0.001        # 0.1% æ»‘ç‚¹
```

æœ€è¿‘è¡¨ç°ï¼ˆv0.3ï¼Œæ‰©å±•çª—å£ç­–ç•¥ï¼Œ2025-04 è‡³ 2026-01ï¼‰:
- æ€»æ”¶ç›Šç‡ï¼š+74.84%
- å¤æ™®æ¯”ç‡ï¼š1.566
- æœ€å¤§å›æ’¤ï¼š47.04%

## è¡¥å……è¯´æ˜

- é»˜è®¤è‚¡ç¥¨æ± ï¼šä¸­è¯500 + ä¸­è¯1000æˆåˆ†è‚¡ï¼ˆçº¦1,500åªï¼‰
- æ’é™¤ä¸­è¯300æˆåˆ†è‚¡
- ç»“æœä¿å­˜åˆ° `.pipeline_data/backtest_results/`ï¼ŒJSON æ ¼å¼
- è®­ç»ƒä½¿ç”¨é‡‡æ ·ï¼ˆ50%æ•°æ®ï¼‰ä»¥åŠ å¿«è¿­ä»£é€Ÿåº¦åŒæ—¶ä¿æŒç¨³å®šæ€§

## å·¥ä½œæµç¨‹

### å®Œæ•´å·¥ä½œæµç¨‹

1. **æ•°æ®å‡†å¤‡**ï¼š
   ```bash
   python -m pipeline.data_cleaning.clean       # æ•°æ®æ¸…æ´—
   python -m pipeline.data_cleaning.features    # ç‰¹å¾å·¥ç¨‹
   python -m pipeline.data_validation.validate  # æ•°æ®æ ¡éªŒ
   ```

2. **æ¨¡å‹è®­ç»ƒä¸å›æµ‹**ï¼š
   ```bash
   # æµ‹è¯•æ¡†æ¶
   python src/lstm/scripts/test_framework.py

   # è¿è¡Œå®Œæ•´å®éªŒï¼ˆå«å›æµ‹å’ŒæŒ‡æ ‡è®¡ç®—ï¼‰
   python src/lstm/scripts/run_experiments.py \
       --strategies expanding_window \
       --calculate_metrics \
       --update_claude_md
   ```

3. **æŸ¥çœ‹ç»“æœ**ï¼š
   - å®éªŒç»“æœï¼š`src/lstm/data/results/experiments/`
   - æ¨¡å‹æ£€æŸ¥ç‚¹ï¼š`src/lstm/data/checkpoints/`

### ä½¿ç”¨ Skillsï¼ˆè‡ªåŠ¨åŒ–å·¥ä½œæµï¼‰

é¡¹ç›®å®šä¹‰äº† 5 ä¸ªæ ¸å¿ƒæŠ€èƒ½ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤è°ƒç”¨ï¼š

- `/clean` - æ•°æ®æ¸…æ´—
- `/validate` - æ•°æ®æ ¡éªŒ
- `/train` - æ¨¡å‹è®­ç»ƒ
- `/backtest` - ç­–ç•¥å›æµ‹
- `/archive` - ç­–ç•¥å½’æ¡£

è¯¦ç»†è¯´æ˜è§ï¼š[.claude/skills/README.md](.claude/skills/README.md)
